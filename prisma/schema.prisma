
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String    // Hashed password
  name          String?   @map("full_name")
  avatarUrl     String?   @map("avatar_url")
  role          String    @default("sales") // 'admin' | 'manager' | 'sales'
  status        String    @default("active") // 'active' | 'disabled'
  createdAt     DateTime  @default(now()) @map("created_at")
  
  // Relations
  leadsAssigned Lead[]    @relation("AssignedTo")
  leadsCreated  Lead[]    @relation("CreatedBy")
  tasksAssigned Task[]    @relation("TaskAssignedTo")
  tasksCreated  Task[]    @relation("TaskCreatedBy")
  activityLogs  ActivityLog[]
  leadNotes     LeadNote[]

  @@map("users")
}

model Lead {
  id              String   @id @default(cuid())
  name            String
  email           String?
  phone           String?
  country         String?
  source          String?
  status          String   @default("new")
  assignedToId    String?  @map("assigned_to")
  assignee        User?    @relation("AssignedTo", fields: [assignedToId], references: [id])
  createdById     String?  @map("created_by")
  creator         User?    @relation("CreatedBy", fields: [createdById], references: [id])
  notes           String?
  lastFollowup    DateTime? @map("last_followup")
  nextFollowup    DateTime? @map("next_followup")
  company         String?
  city            String?
  profession      String?
  courseName      String?   @map("course_name")
  timeInSession   String?   @map("time_in_session")
  daysAttended    Int?      @default(0) @map("days_attended")
  bootcampAttendee Boolean? @default(false) @map("bootcamp_attendee")
  
  utmSource       String?   @map("utm_source")
  utmCampaign     String?   @map("utm_campaign")
  utmMedium       String?   @map("utm_medium")
  utmContent      String?   @map("utm_content")
  utmTerm         String?   @map("utm_term")
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  tasks           Task[]
  leadNotes       LeadNote[]

  @@map("leads")
}

model Task {
  id             String   @id @default(cuid())
  title          String
  description    String?
  priority       String   @default("medium")
  status         String   @default("pending")
  dueDate        DateTime? @map("due_date")
  assignedToId   String?  @map("assigned_to")
  assignee       User?    @relation("TaskAssignedTo", fields: [assignedToId], references: [id])
  leadId         String?  @map("lead_id")
  lead           Lead?    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  createdById    String?  @map("created_by")
  creator        User?    @relation("TaskCreatedBy", fields: [createdById], references: [id])
  createdAt      DateTime @default(now()) @map("created_at")

  @@map("tasks")
}

model LeadNote {
  id        String   @id @default(cuid())
  content   String
  leadId    String   @map("lead_id")
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  userId    String   @map("user_id")
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")

  @@map("lead_notes")
}

model ActivityLog {
  id         String   @id @default(cuid())
  userId     String?  @map("user_id")
  user       User?    @relation(fields: [userId], references: [id])
  action     String
  entityType String   @map("entity_type")
  entityId   String?  @map("entity_id")
  details    String   // Stored as JSON string
  createdAt  DateTime @default(now()) @map("created_at")

  @@map("activity_logs")
}
